<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Theo Boutaris" />

<meta name="date" content="2016-11-30" />

<title>colf</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">colf</h1>
<h4 class="author"><em>Theo Boutaris</em></h4>
<h4 class="date"><em>2016-11-30</em></h4>



<div id="colf" class="section level2">
<h2>colf</h2>
<p>This is a package dedicated to performing a least squares constrained optimization on a linear objective function. The functions minimize the same objective function as <code>lm</code>, applying a constraint on the beta parameters:</p>
<p><span class="math display">\[S(\beta) = \sum_{i=1}^m \vert y_i - \sum_{j=1}^nX_{ij}\beta_j \vert^2 = \Vert y - X\beta\Vert^2\]</span></p>
<p>And</p>
<p><span class="math display">\[\hat{\beta} = arg_\beta min \ S(\beta)\]</span></p>
<p>The idea behind the package is to give the users a way to perform a constrained “linear regression” in an easy and intuitive way. The functions require a formula in the same syntax and format as <code>lm</code> which is a style most R users are familiar with.</p>
<p>So far the package includes two functions in order to perform the constrained optimization:</p>
<ul>
<li><code>colf_nls</code> - uses the port algorithm which comes from the <code>stats::nls</code> function.</li>
<li><code>colf_nlxb</code> - uses Nash’s variant of Marquardt nonlinear least squares solution which comes from the <code>nlmrt::nlxb</code> function.</li>
</ul>
<p>You can find more details about the two algorithms if you have a look at <code>?nls</code> and <code>?nlxb</code> respectively.</p>
</div>
<div id="colf_nls" class="section level2">
<h2>colf_nls</h2>
<p>Now we will see how we can easily use the port algorithm to perform a constrained optimization. As you will see we are using <code>colf_nls</code> in the same way we would use <code>lm</code> with the addition of upper and lower bounds for our parameter estimates.</p>
<p>We will use the <code>mtcars</code> data set for a demonstration. Let’s load the package and use <code>mtcars</code> to run a constrained least squares optimization model.</p>
<p>In the model below we use 4 variables to model mpg which means we will have 5 parameter estimates (don’t forget the Intercept). Parameters are prefixed with <code>param_</code> in the model’s output. We set the lower bounds of those 4 parameter estimates to -2 and the upper bounds to 2 (obviously they do not need to be the same). Ideally, starting values should be provided. If omitted a cheap guess will be made, which is basically setting all starting values to 1. If the staring values do not fall within the boundaries defined by lower and upper then an error will be returned and you would need to manually change the starting values via the <code>start</code> argument.</p>
<div id="usage" class="section level4">
<h4>Usage</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(colf)</code></pre></div>
<pre><code>## Loading required package: nlmrt</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mymod &lt;-<span class="st"> </span><span class="kw">colf_nls</span>(mpg ~<span class="st"> </span>cyl +<span class="st"> </span>disp +<span class="st"> </span>hp +<span class="st"> </span>qsec, mtcars, <span class="dt">lower =</span> <span class="kw">rep</span>(-<span class="dv">2</span>, <span class="dv">5</span>), <span class="dt">upper =</span> <span class="kw">rep</span>(<span class="dv">2</span>, <span class="dv">5</span>))
mymod</code></pre></div>
<pre><code>## Nonlinear regression model
##   model: mpg ~ param_X.Intercept. * X.Intercept. + param_cyl * cyl + param_disp *     disp + param_hp * hp + param_qsec * qsec
##    data: model_ingredients$model_data
## param_X.Intercept.          param_cyl         param_disp 
##            2.00000            0.23936           -0.03868 
##           param_hp         param_qsec 
##            0.01033            1.33915 
##  residual sum-of-squares: 417.6
## 
## Algorithm &quot;port&quot;, convergence message: both X-convergence and relative convergence (5)</code></pre>
<p>As you can see all 5 parameter estimates fall within the defined boundaries. The above provided formula includes the Intercept. In the output, X.Intercept is a variable set to 1 and param_X.Intercept is the estimated intercept.</p>
<p>If starting values do not fall within the boundaries an error will be returned. As said previously if not provided they will be set to 1.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colf_nls</span>(mpg ~<span class="st"> </span>cyl +<span class="st"> </span>disp +<span class="st"> </span>hp +<span class="st"> </span>qsec, mtcars, <span class="dt">lower =</span> <span class="kw">rep</span>(-<span class="dv">2</span>, <span class="dv">5</span>), <span class="dt">upper =</span> <span class="kw">rep</span>(<span class="fl">0.5</span>, <span class="dv">5</span>))</code></pre></div>
<pre><code>## Error in nls(model_ingredients$model_formula, data = model_ingredients$model_data, : Convergence failure: initial par violates constraints</code></pre>
<p>So, then they need to be set by the user:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colf_nls</span>(mpg ~<span class="st"> </span>cyl +<span class="st"> </span>disp +<span class="st"> </span>hp +<span class="st"> </span>qsec, mtcars, <span class="dt">lower =</span> <span class="kw">rep</span>(-<span class="dv">2</span>, <span class="dv">5</span>), <span class="dt">upper =</span> <span class="kw">rep</span>(<span class="fl">0.5</span>, <span class="dv">5</span>), 
         <span class="dt">start =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">5</span>))</code></pre></div>
<pre><code>## Nonlinear regression model
##   model: mpg ~ param_X.Intercept. * X.Intercept. + param_cyl * cyl + param_disp *     disp + param_hp * hp + param_qsec * qsec
##    data: model_ingredients$model_data
## param_X.Intercept.          param_cyl         param_disp 
##            0.50000            0.50000           -0.02539 
##           param_hp         param_qsec 
##            0.06971            0.50000 
##  residual sum-of-squares: 2238
## 
## Algorithm &quot;port&quot;, convergence message: both X-convergence and relative convergence (5)</code></pre>
</div>
<div id="alternative-ways-to-define-the-formula" class="section level4">
<h4>Alternative ways to define the formula</h4>
<p>As with <code>lm</code>, <code>colf_nls</code> accepts the same kind of formula syntax:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#no intercept</span>
<span class="kw">colf_nls</span>(mpg ~<span class="st"> </span><span class="dv">0</span> +<span class="st"> </span>hp +<span class="st"> </span>cyl, mtcars)</code></pre></div>
<pre><code>## Nonlinear regression model
##   model: mpg ~ param_hp * hp + param_cyl * cyl
##    data: model_ingredients$model_data
##  param_hp param_cyl 
##   -0.1075    5.4036 
##  residual sum-of-squares: 3150
## 
## Algorithm &quot;port&quot;, convergence message: relative convergence (4)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colf_nls</span>(mpg ~<span class="st"> </span>., mtcars)</code></pre></div>
<pre><code>## Nonlinear regression model
##   model: mpg ~ param_X.Intercept. * X.Intercept. + param_cyl * cyl + param_disp *     disp + param_hp * hp + param_drat * drat + param_wt * wt +     param_qsec * qsec + param_vs * vs + param_am * am + param_gear *     gear + param_carb * carb
##    data: model_ingredients$model_data
## param_X.Intercept.          param_cyl         param_disp 
##           12.30335           -0.11144            0.01334 
##           param_hp         param_drat           param_wt 
##           -0.02148            0.78711           -3.71530 
##         param_qsec           param_vs           param_am 
##            0.82104            0.31776            2.52023 
##         param_gear         param_carb 
##            0.65541           -0.19942 
##  residual sum-of-squares: 147.5
## 
## Algorithm &quot;port&quot;, convergence message: relative convergence (4)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colf_nls</span>(mpg ~<span class="st"> </span><span class="kw">I</span>(hp +<span class="st"> </span>cyl), mtcars)</code></pre></div>
<pre><code>## Nonlinear regression model
##   model: mpg ~ param_X.Intercept. * X.Intercept. + param_I.hp...cyl. *     I.hp...cyl.
##    data: model_ingredients$model_data
## param_X.Intercept.  param_I.hp...cyl. 
##           30.36670           -0.06722 
##  residual sum-of-squares: 438.6
## 
## Algorithm &quot;port&quot;, convergence message: both X-convergence and relative convergence (5)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colf_nls</span>(mpg ~<span class="st"> </span>(hp +<span class="st"> </span>cyl +<span class="st"> </span>disp)^<span class="dv">3</span>, mtcars)</code></pre></div>
<pre><code>## Nonlinear regression model
##   model: mpg ~ param_X.Intercept. * X.Intercept. + param_hp * hp + param_cyl *     cyl + param_disp * disp + param_hp.cyl * hp.cyl + param_hp.disp *     hp.disp + param_cyl.disp * cyl.disp + param_hp.cyl.disp *     hp.cyl.disp
##    data: model_ingredients$model_data
## param_X.Intercept.           param_hp          param_cyl 
##          9.290e+01         -4.703e-01         -1.059e+01 
##         param_disp       param_hp.cyl      param_hp.disp 
##         -3.865e-01          6.734e-02          2.808e-03 
##     param_cyl.disp  param_hp.cyl.disp 
##          5.270e-02         -3.841e-04 
##  residual sum-of-squares: 153.9
## 
## Algorithm &quot;port&quot;, convergence message: both X-convergence and relative convergence (5)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colf_nls</span>(mpg ~<span class="st"> </span>hp:cyl, mtcars)</code></pre></div>
<pre><code>## Nonlinear regression model
##   model: mpg ~ param_X.Intercept. * X.Intercept. + param_hp.cyl * hp.cyl
##    data: model_ingredients$model_data
## param_X.Intercept.       param_hp.cyl 
##           27.26649           -0.00713 
##  residual sum-of-squares: 407.2
## 
## Algorithm &quot;port&quot;, convergence message: both X-convergence and relative convergence (5)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colf_nls</span>(mpg ~<span class="st"> </span>hp *<span class="st"> </span>cyl, mtcars)</code></pre></div>
<pre><code>## Nonlinear regression model
##   model: mpg ~ param_X.Intercept. * X.Intercept. + param_hp * hp + param_cyl *     cyl + param_hp.cyl * hp.cyl
##    data: model_ingredients$model_data
## param_X.Intercept.           param_hp          param_cyl 
##           50.75121           -0.17068           -4.11914 
##       param_hp.cyl 
##            0.01974 
##  residual sum-of-squares: 247.6
## 
## Algorithm &quot;port&quot;, convergence message: relative convergence (4)</code></pre>
<p>Notice that when the above versions are used, the parameter names are created with the use of <code>make.names</code> in order to be syntactically valid (otherwise the optimizers fail). This is why you see an ‘X.’ in front of the intercept or too many dots in the names.</p>
</div>
<div id="predict-and-rest-of-methods" class="section level4">
<h4>Predict and rest of Methods</h4>
<p><code>colf</code> provides a number of methods for <code>colf</code> objects:</p>
<ul>
<li><code>predict</code> - uses parameter estimates to predict on a new data set</li>
<li><code>coef</code> - retrieve the coefficients</li>
<li><code>resid</code> - retrieve the residuals</li>
<li><code>print</code> - print the model</li>
<li><code>summary</code> - view a summary of the model</li>
<li><code>fitted</code> - retrieve the fitted values</li>
</ul>
<p>In order to use the parameter estimates to make predictions on a new data set you need to remember two <strong>really important</strong> checks:</p>
<ul>
<li>The new data set needs to contain exactly the same column names as the original one</li>
<li>The new data set’s columns should have exactly the same column classes</li>
</ul>
<p>If any of the two is not valid, <code>predict</code> will fail.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">10</span>)
newdata &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">hp =</span> mtcars$hp, <span class="dt">cyl =</span> mtcars$cyl, <span class="dt">disp =</span> mtcars$disp, <span class="dt">qsec =</span> mtcars$qsec)
<span class="kw">predict</span>(mymod, newdata)</code></pre></div>
<pre><code>##        1        2        3        4        5        6        7        8 
## 20.42650 21.17642 24.66251 20.62689 14.59128 22.89609 13.73409 24.70696 
##        9       10       11       12       13       14       15       16 
## 29.15952 22.73086 23.53435 18.40833 18.67616 19.21182 11.85499 12.20813 
##       17       18       19       20       21       22       23       24 
## 12.60092 26.66851 25.36775 27.52795 26.11065 15.75659 16.87389 13.54502 
##       25       26       27       28       29       30       31       32 
## 13.08441 25.89359 21.60836 23.07806 12.48397 20.39243 15.28503 24.31159</code></pre>
<p>But if I change any of the names or classes <code>predict</code> will fail</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#change column name</span>
newdata2 &lt;-<span class="st"> </span>newdata
<span class="kw">names</span>(newdata2)[<span class="dv">1</span>] &lt;-<span class="st"> 'col1'</span>
<span class="kw">predict</span>(mymod, newdata2)</code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): object 'hp' not found</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#change column class</span>
newdata2 &lt;-<span class="st"> </span>newdata
newdata2$cyl &lt;-<span class="st"> </span><span class="kw">as.character</span>(newdata2$cyl)  
<span class="kw">predict</span>(mymod, newdata2)</code></pre></div>
<pre><code>## Error in value[[3L]](cond): newdata column classes need to be the same as original data</code></pre>
<p>The rest of the <code>colf_nls</code> methods are demonstrated below:</p>
<p>You need to be careful when using <code>summary</code> because it returns p-values. By default <code>nls</code> and <code>nlxb</code> both return p-values for the coefficients, which were naturally passed on to colf. When running an unconstrained regression the p-values show us how likely it is for the estimate to be zero. In constrained regression though this may not even hold if you think that a restriction (and actually a common one) is to force the coefficients to be positive. In such a case the hypothesis test does not hold at all since we have restricted the coefficients to be positive. In constrained regression other assumptions that we make in unconstrained regression do not hold either (like the coefficients’ distribution) so the use and interpretation of the p-values can be problematic when we set lower and/or upper.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(mymod)</code></pre></div>
<pre><code>## 
## Formula: mpg ~ param_X.Intercept. * X.Intercept. + param_cyl * cyl + param_disp * 
##     disp + param_hp * hp + param_qsec * qsec
## 
## Parameters:
##                    Estimate Std. Error t value Pr(&gt;|t|)  
## param_X.Intercept.  2.00000   14.03972   0.142   0.8878  
## param_cyl           0.23936    1.08431   0.221   0.8269  
## param_disp         -0.03868    0.01480  -2.614   0.0145 *
## param_hp            0.01033    0.02281   0.453   0.6543  
## param_qsec          1.33915    0.61867   2.165   0.0394 *
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 3.933 on 27 degrees of freedom
## 
## Algorithm &quot;port&quot;, convergence message: both X-convergence and relative convergence (5)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(mymod)</code></pre></div>
<pre><code>## param_X.Intercept.          param_cyl         param_disp 
##         2.00000000         0.23936324        -0.03867617 
##           param_hp         param_qsec 
##         0.01032870         1.33914623</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(mymod)</code></pre></div>
<pre><code>## Nonlinear regression model
##   model: mpg ~ param_X.Intercept. * X.Intercept. + param_cyl * cyl + param_disp *     disp + param_hp * hp + param_qsec * qsec
##    data: model_ingredients$model_data
## param_X.Intercept.          param_cyl         param_disp 
##            2.00000            0.23936           -0.03868 
##           param_hp         param_qsec 
##            0.01033            1.33915 
##  residual sum-of-squares: 417.6
## 
## Algorithm &quot;port&quot;, convergence message: both X-convergence and relative convergence (5)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">resid</span>(mymod)</code></pre></div>
<pre><code>##  [1]  0.5735028 -0.1764190 -1.8625077  0.7731114  4.1087220 -4.7960927
##  [7]  0.5659052 -0.3069635 -6.3595242 -3.5308605 -5.7343482 -2.0083303
## [13] -1.3761596 -4.0118181 -1.4549889 -1.8081266  2.0990781  5.7314898
## [19]  5.0322521  6.3720468 -4.6106457 -0.2565875 -1.6738867 -0.2450235
## [25]  6.1155942  1.4064060  4.3916358  7.3219357  3.3160303 -0.6924250
## [31] -0.2850306 -2.9115854
## attr(,&quot;label&quot;)
## [1] &quot;Residuals&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fitted</span>(mymod)</code></pre></div>
<pre><code>##  [1] 20.42650 21.17642 24.66251 20.62689 14.59128 22.89609 13.73409
##  [8] 24.70696 29.15952 22.73086 23.53435 18.40833 18.67616 19.21182
## [15] 11.85499 12.20813 12.60092 26.66851 25.36775 27.52795 26.11065
## [22] 15.75659 16.87389 13.54502 13.08441 25.89359 21.60836 23.07806
## [29] 12.48397 20.39243 15.28503 24.31159
## attr(,&quot;label&quot;)
## [1] &quot;Fitted values&quot;</code></pre>
</div>
</div>
<div id="colf_nlxb" class="section level2">
<h2>colf_nlxb</h2>
<p><code>colf_nlxb</code> can be used in the exact same way as <code>colf_nls</code>. All aspects / features discussed about <code>colf_nls</code> do stand for <code>colf_nlxb</code> as well. Only the underlying algorithm changes.</p>
<div id="usage-1" class="section level4">
<h4>Usage</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mymod &lt;-<span class="st"> </span><span class="kw">colf_nlxb</span>(mpg ~<span class="st"> </span>cyl +<span class="st"> </span>disp +<span class="st"> </span>hp +<span class="st"> </span>qsec, mtcars, <span class="dt">lower =</span> <span class="kw">rep</span>(-<span class="dv">2</span>, <span class="dv">5</span>), <span class="dt">upper =</span> <span class="kw">rep</span>(<span class="dv">2</span>, <span class="dv">5</span>))
mymod</code></pre></div>
<pre><code>## nlmrt class object: x 
## residual sumsquares =  1505  on  32 observations
##     after  7    Jacobian and  7 function evaluations
##   name            coeff          SE       tstat      pval      gradient    JSingval   
## param_X.Intercept.             2U           NA         NA         NA     0.03109        1724  
## param_cyl             -2L           NA         NA         NA           0       225.9  
## param_disp     0.0385865            NA         NA         NA       22571       48.42  
## param_hp      0.00231996            NA         NA         NA        8807      0.3248  
## param_qsec       1.18908            NA         NA         NA      -25.67   1.908e-14</code></pre>
<p>Setting lower, upper and starting values:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#start values are outside boundaries</span>
<span class="kw">colf_nlxb</span>(mpg ~<span class="st"> </span>cyl +<span class="st"> </span>disp +<span class="st"> </span>hp +<span class="st"> </span>qsec, mtcars, <span class="dt">lower =</span> <span class="kw">rep</span>(-<span class="dv">2</span>, <span class="dv">5</span>), <span class="dt">upper =</span> <span class="kw">rep</span>(<span class="fl">0.5</span>, <span class="dv">5</span>))</code></pre></div>
<pre><code>## Error in nlxb(model_ingredients$model_formula, data = model_ingredients$model_data, : Infeasible start</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#so they need to be provided</span>
<span class="kw">colf_nlxb</span>(mpg ~<span class="st"> </span>cyl +<span class="st"> </span>disp +<span class="st"> </span>hp +<span class="st"> </span>qsec, mtcars, <span class="dt">lower =</span> <span class="kw">rep</span>(-<span class="dv">5</span>, <span class="dv">5</span>), <span class="dt">upper =</span> <span class="kw">rep</span>(.<span class="dv">5</span>, <span class="dv">5</span>), 
         <span class="dt">start =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">5</span>))</code></pre></div>
<pre><code>## nlmrt class object: x 
## residual sumsquares =  2237.9  on  32 observations
##     after  5    Jacobian and  6 function evaluations
##   name            coeff          SE       tstat      pval      gradient    JSingval   
## param_X.Intercept.           0.5U           NA         NA         NA           0        1721  
## param_cyl            0.5U           NA         NA         NA           0       225.6  
## param_disp     -0.025392            NA         NA         NA   2.004e-05    3.92e-14  
## param_hp       0.0697104            NA         NA         NA   -1.28e-05           0  
## param_qsec           0.5U           NA         NA         NA           0           0</code></pre>
</div>
<div id="alternative-ways-to-use-formula-similar-to-lm" class="section level4">
<h4>Alternative ways to use formula, similar to <code>lm</code>:</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#no intercept</span>
<span class="kw">colf_nlxb</span>(mpg ~<span class="st"> </span><span class="dv">0</span> +<span class="st"> </span>hp +<span class="st"> </span>cyl, mtcars)</code></pre></div>
<pre><code>## nlmrt class object: x 
## residual sumsquares =  3149.5  on  32 observations
##     after  3    Jacobian and  4 function evaluations
##   name            coeff          SE       tstat      pval      gradient    JSingval   
## param_hp       -0.107466       0.04538     -2.368    0.02453   3.542e-05       914.1  
## param_cyl        5.40364         1.139      4.743  4.806e-05  -1.411e-06       8.987</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colf_nlxb</span>(mpg ~<span class="st"> </span>., mtcars)</code></pre></div>
<pre><code>## nlmrt class object: x 
## residual sumsquares =  147.5  on  32 observations
##     after  2    Jacobian and  3 function evaluations
##   name            coeff          SE       tstat      pval      gradient    JSingval   
## param_X.Intercept.       12.0809         18.72     0.6454     0.5256   -0.002687        1724  
## param_cyl      -0.106182         1.045    -0.1016       0.92   -0.006288       226.1  
## param_disp     0.0134351       0.01786     0.7523     0.4602      0.5555        50.9  
## param_hp       -0.021483       0.02177    -0.9869     0.3349   -0.007217       5.651  
## param_drat      0.791165         1.635     0.4838     0.6335    0.000208       4.279  
## param_wt        -3.72978         1.894     -1.969    0.06231   -0.008281        4.05  
## param_qsec      0.830959        0.7308      1.137     0.2684     0.06451       1.624  
## param_vs        0.310536         2.105     0.1476     0.8841  -1.193e-05       1.405  
## param_am         2.52665         2.057      1.229     0.2328   3.127e-05       1.237  
## param_gear      0.659013         1.493     0.4413     0.6635  -0.0004484       1.114  
## param_carb     -0.196141        0.8288    -0.2367     0.8152    0.001945      0.1412</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colf_nlxb</span>(mpg ~<span class="st"> </span><span class="kw">I</span>(hp +<span class="st"> </span>cyl), mtcars)</code></pre></div>
<pre><code>## nlmrt class object: x 
## residual sumsquares =  438.6  on  32 observations
##     after  3    Jacobian and  4 function evaluations
##   name            coeff          SE       tstat      pval      gradient    JSingval   
## param_X.Intercept.       30.3667         1.644      18.47          0  -2.861e-08       948.7  
## param_I.hp...cyl.    -0.0672188      0.009803     -6.857  1.307e-07    4.66e-06       2.326</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colf_nlxb</span>(mpg ~<span class="st"> </span>(hp +<span class="st"> </span>cyl +<span class="st"> </span>disp)^<span class="dv">3</span>, mtcars)</code></pre></div>
<pre><code>## nlmrt class object: x 
## residual sumsquares =  6207826  on  32 observations
##     after  2    Jacobian and  3 function evaluations
##   name            coeff          SE       tstat      pval      gradient    JSingval   
## param_X.Intercept.      -25360.2          5433     -4.668  9.661e-05      -2.243     2366035  
## param_hp         244.848         51.95      4.714  8.603e-05       822.4       21312  
## param_cyl        4240.78         991.4      4.278  0.0002606       35.87        2294  
## param_disp       183.856          38.7      4.751  7.822e-05        1051        1232  
## param_hp.cyl      -35.5872          7.73     -4.604  0.0001137      -10075       59.65  
## param_hp.disp      -1.98104        0.4075     -4.862  5.904e-05    -1091700        35.3  
## param_cyl.disp      -26.2739         5.546     -4.738  8.089e-05      -15164       1.995  
## param_hp.cyl.disp      0.262991       0.05378       4.89  5.495e-05    10169977     0.09218</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colf_nlxb</span>(mpg ~<span class="st"> </span>hp:cyl, mtcars)</code></pre></div>
<pre><code>## nlmrt class object: x 
## residual sumsquares =  407.2  on  32 observations
##     after  2    Jacobian and  3 function evaluations
##   name            coeff          SE       tstat      pval      gradient    JSingval   
## param_X.Intercept.       27.2664         1.182      23.07          0  -0.0004518        6823  
## param_hp.cyl   -0.00713034     0.0009798     -7.277  4.203e-08      0.6283       3.118</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colf_nlxb</span>(mpg ~<span class="st"> </span>hp *<span class="st"> </span>cyl, mtcars)</code></pre></div>
<pre><code>## nlmrt class object: x 
## residual sumsquares =  247.6  on  32 observations
##     after  3    Jacobian and  4 function evaluations
##   name            coeff          SE       tstat      pval      gradient    JSingval   
## param_X.Intercept.       50.7659         6.512      7.796  1.715e-08   0.0004441        6882  
## param_hp       -0.170838        0.0691     -2.472    0.01977     -0.1207       155.2  
## param_cyl        -4.1211        0.9882      -4.17  0.0002658   -0.002382       8.313  
## param_hp.cyl     0.0197579      0.008811      2.242    0.03303      0.8746      0.4521</code></pre>
</div>
<div id="predict-and-rest-of-the-methods" class="section level4">
<h4>Predict and rest of the methods</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">10</span>)
newdata &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">hp =</span> mtcars$hp, <span class="dt">cyl =</span> mtcars$cyl, <span class="dt">disp =</span> mtcars$disp, <span class="dt">qsec =</span> mtcars$qsec)
<span class="kw">predict</span>(mymod, newdata)</code></pre></div>
<pre><code>##      1      2      3      4      5      6      7      8      9     10 
## 16.001 16.667 20.512 23.326 20.535 22.969 19.295 23.586 26.883 18.513 
##     11     12     13     14     15     16     17     18     19     20 
## 19.226 17.750 17.988 18.463 26.068 25.438 24.225 20.341 19.063 20.557 
##     21     22     23     24     25     26     27     28     29     30 
## 22.653 18.678 18.649 18.397 22.114 19.675 18.711 18.027 17.398 14.432 
##     31     32 
## 15.752 21.039</code></pre>
<p>As with <code>colf_nls</code>, in <code>colf_nlxb</code> keeping names and classes the same is vital:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#change column name</span>
newdata2 &lt;-<span class="st"> </span>newdata
<span class="kw">names</span>(newdata2)[<span class="dv">1</span>] &lt;-<span class="st"> 'col1'</span>
<span class="kw">predict</span>(mymod, newdata2)</code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): object 'hp' not found</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#change column class</span>
newdata2 &lt;-<span class="st"> </span>newdata
newdata2$cyl &lt;-<span class="st"> </span><span class="kw">as.character</span>(newdata2$cyl)  
<span class="kw">predict</span>(mymod, newdata2)</code></pre></div>
<pre><code>## Error in value[[3L]](cond): newdata column classes need to be the same as original data</code></pre>
<p>Rest of methods provided:</p>
<p>Please make sure you read the section about the interpretation of the p-values at <code>colf_nls</code> when running a constrained regression. The same principles described there hold for <code>colf_nlxb</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(mymod)</code></pre></div>
<pre><code>## $resname
## [1] &quot;mymod&quot;
## 
## $ssquares
## [1] 1505
## 
## $nobs
## [1] 32
## 
## $coeff
## param_X.Intercept.          param_cyl         param_disp 
##           2.000000          -2.000000           0.038586 
##           param_hp         param_qsec 
##           0.002320           1.189077 
## 
## $ct
## [1] &quot;U&quot; &quot;L&quot; &quot; &quot; &quot; &quot; &quot; &quot;
## 
## $mt
## [1] &quot; &quot; &quot; &quot; &quot; &quot; &quot; &quot; &quot; &quot;
## 
## $SEs
## [1] NA NA NA NA NA
## 
## $tstat
## [1] NA NA NA NA NA
## 
## $pval
## [1] NA NA NA NA NA
## 
## $Sd
## [1] 1.7236e+03 2.2588e+02 4.8424e+01 3.2482e-01 1.9079e-14
## 
## $gr
##                           [,1]
## param_X.Intercept.  3.1092e-02
## param_cyl           0.0000e+00
## param_disp          2.2571e+04
## param_hp            8.8068e+03
## param_qsec         -2.5675e+01
## 
## $jeval
## [1] 7
## 
## $feval
## [1] 7</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(mymod)</code></pre></div>
<pre><code>## param_X.Intercept.          param_cyl         param_disp 
##           2.000000          -2.000000           0.038586 
##           param_hp         param_qsec 
##           0.002320           1.189077</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(mymod)</code></pre></div>
<pre><code>## nlmrt class object: x 
## residual sumsquares =  1505  on  32 observations
##     after  7    Jacobian and  7 function evaluations
##   name            coeff          SE       tstat      pval      gradient    JSingval   
## param_X.Intercept.             2U           NA         NA         NA     0.03109        1724  
## param_cyl             -2L           NA         NA         NA           0       225.9  
## param_disp     0.0385865            NA         NA         NA       22571       48.42  
## param_hp      0.00231996            NA         NA         NA        8807      0.3248  
## param_qsec       1.18908            NA         NA         NA      -25.67   1.908e-14</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">resid</span>(mymod)</code></pre></div>
<pre><code>##           Mazda RX4       Mazda RX4 Wag          Datsun 710 
##            -4.99876            -4.33287            -2.28818 
##      Hornet 4 Drive   Hornet Sportabout             Valiant 
##             1.92617             1.83522             4.86870 
##          Duster 360           Merc 240D            Merc 230 
##             4.99451            -0.81398             4.08324 
##            Merc 280           Merc 280C          Merc 450SE 
##            -0.68744             1.42601             1.34969 
##          Merc 450SL         Merc 450SLC  Cadillac Fleetwood 
##             0.68750             3.26314            15.66802 
## Lincoln Continental   Chrysler Imperial            Fiat 128 
##            15.03793             9.52537           -12.05880 
##         Honda Civic      Toyota Corolla       Toyota Corona 
##           -11.33666           -13.34307             1.15271 
##    Dodge Challenger         AMC Javelin          Camaro Z28 
##             3.17823             3.44932             5.09734 
##    Pontiac Firebird           Fiat X1-9       Porsche 914-2 
##             2.91435            -7.62499            -7.28934 
##        Lotus Europa      Ford Pantera L        Ferrari Dino 
##           -12.37287             1.59795            -5.26827 
##       Maserati Bora          Volvo 142E 
##             0.75225            -0.36133</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fitted</span>(mymod)</code></pre></div>
<pre><code>##           Mazda RX4       Mazda RX4 Wag          Datsun 710 
##              16.001              16.667              20.512 
##      Hornet 4 Drive   Hornet Sportabout             Valiant 
##              23.326              20.535              22.969 
##          Duster 360           Merc 240D            Merc 230 
##              19.295              23.586              26.883 
##            Merc 280           Merc 280C          Merc 450SE 
##              18.513              19.226              17.750 
##          Merc 450SL         Merc 450SLC  Cadillac Fleetwood 
##              17.988              18.463              26.068 
## Lincoln Continental   Chrysler Imperial            Fiat 128 
##              25.438              24.225              20.341 
##         Honda Civic      Toyota Corolla       Toyota Corona 
##              19.063              20.557              22.653 
##    Dodge Challenger         AMC Javelin          Camaro Z28 
##              18.678              18.649              18.397 
##    Pontiac Firebird           Fiat X1-9       Porsche 914-2 
##              22.114              19.675              18.711 
##        Lotus Europa      Ford Pantera L        Ferrari Dino 
##              18.027              17.398              14.432 
##       Maserati Bora          Volvo 142E 
##              15.752              21.039</code></pre>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
